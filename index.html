<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>档案记录系统 - 初始化界面</title>
<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(139, 107, 70, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(139, 107, 70, 0.05) 0%, transparent 50%),
    #f5f1e8;
  overflow: hidden;
  cursor: crosshair;
  font-family: 'Georgia', 'Times New Roman', '宋体', serif;
  color: #2c1810;
  position: relative;
}

/* 纸张纹理效果 */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),
    linear-gradient(#eee .1em, transparent .1em);
  background-size: 100% 1.2em;
  opacity: 0.3;
  pointer-events: none;
  z-index: 0;
}

/* 纸张边缘效果 */
body::after {
  content: '';
  position: fixed;
  top: 20px;
  left: 20px;
  right: 20px;
  bottom: 20px;
  border: 1px solid rgba(139, 107, 70, 0.3);
  box-shadow: 
    0 0 30px rgba(139, 107, 70, 0.1),
    inset 0 0 30px rgba(139, 107, 70, 0.05);
  pointer-events: none;
  z-index: 0;
}

/* ===== 十字线 ===== */
.cross {
  position: absolute;
  pointer-events: none;
  z-index: 1;
}

.line {
  position: absolute;
  background: rgba(139, 107, 70, 0.7);
  box-shadow: 0 0 2px rgba(139, 107, 70, 0.3);
}

.h-line { 
  height: 1px; 
  width: 160vw; 
  border-top: 1px solid #8b6b46;
}
.v-line { 
  width: 1px; 
  height: 160vh; 
  border-left: 1px solid #8b6b46;
}

/* ===== HUD ===== */
.hud {
  position: absolute;
  width: 360px;
  height: 360px;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 2;
  filter: sepia(0.3);
}

/* ===== Phase 4 闪烁 ===== */
.lock-pulse {
  animation: pulse 0.35s ease-in-out 4;
}

@keyframes pulse {
  0%   { opacity: 0.3; stroke: #8b6b46; }
  50%  { opacity: 0.8; stroke: #a37c52; }
  100% { opacity: 0.3; stroke: #8b6b46; }
}

/* ===== 旋转 ===== */
.rotating {
  transform-origin: 180px 180px;
}

/* ===== 快速单次消失效果 ===== */
@keyframes quickDisappear {
  0%   { opacity: 1; }
  20%  { opacity: 0.1; }
  80%  { opacity: 0.1; }
  100% { opacity: 1; }
}

.quick-disappear {
  animation: quickDisappear 0.6s ease-in-out 1 forwards;
}

/* ===== 游戏UI界面 ===== */
.game-ui {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
  opacity: 0;
  transition: opacity 1.2s ease;
}

.game-ui.show {
  opacity: 1;
  pointer-events: auto;
}

/* 开始记录按钮 */
.start-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 20px 50px;
  font-size: 24px;
  font-weight: normal;
  color: #2c1810;
  background: rgba(245, 241, 232, 0.9);
  border: 2px solid #8b6b46;
  border-radius: 2px;
  cursor: pointer;
  transition: all 0.4s ease;
  box-shadow: 
    0 4px 8px rgba(139, 107, 70, 0.2),
    0 0 0 1px rgba(139, 107, 70, 0.1);
  letter-spacing: 1px;
  pointer-events: auto;
  font-family: 'Georgia', serif;
  text-transform: uppercase;
  overflow: hidden;
}

.start-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(139, 107, 70, 0.1), transparent);
  transition: left 0.7s ease;
}

.start-button:hover {
  transform: translate(-50%, -50%);
  box-shadow: 
    0 6px 12px rgba(139, 107, 70, 0.3),
    0 0 0 1px rgba(139, 107, 70, 0.2),
    inset 0 0 20px rgba(139, 107, 70, 0.1);
  background: rgba(255, 253, 248, 0.95);
  letter-spacing: 2px;
}

.start-button:hover::before {
  left: 100%;
}

.start-button:active {
  transform: translate(-50%, -50%) scale(0.99);
}

/* 右上角档案系统 */
.achievement-panel {
  position: absolute;
  top: 40px;
  right: 40px;
  background: rgba(245, 241, 232, 0.95);
  border-radius: 1px;
  padding: 20px;
  box-shadow: 
    0 4px 12px rgba(139, 107, 70, 0.2),
    inset 0 0 0 1px rgba(139, 107, 70, 0.3),
    inset 0 0 10px rgba(139, 107, 70, 0.05);
  min-width: 240px;
  pointer-events: auto;
  transition: all 0.3s ease;
  border: 1px solid #8b6b46;
}

.achievement-panel:hover {
  box-shadow: 
    0 6px 16px rgba(139, 107, 70, 0.25),
    inset 0 0 0 1px rgba(139, 107, 70, 0.4),
    inset 0 0 15px rgba(139, 107, 70, 0.08);
}

.achievement-title {
  font-size: 18px;
  font-weight: bold;
  color: #2c1810;
  margin-bottom: 15px;
  border-bottom: 2px solid #8b6b46;
  padding-bottom: 8px;
  letter-spacing: 1px;
  font-family: 'Times New Roman', serif;
  text-transform: uppercase;
  position: relative;
}

.achievement-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: #8b6b46;
}

.achievement-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.achievement-item {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 15px;
  color: #5a4638;
  padding: 10px 12px;
  border-radius: 1px;
  background: rgba(255, 253, 248, 0.7);
  transition: all 0.3s ease;
  border: 1px solid rgba(139, 107, 70, 0.2);
}

.achievement-item:hover {
  background: rgba(255, 253, 248, 0.9);
  border-color: rgba(139, 107, 70, 0.4);
  transform: translateX(2px);
}

.achievement-icon {
  width: 24px;
  height: 24px;
  border-radius: 1px;
  background: rgba(139, 107, 70, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  border: 1px solid rgba(139, 107, 70, 0.3);
  flex-shrink: 0;
  font-family: 'Arial', sans-serif;
}

.achievement-unlocked {
  background: rgba(139, 107, 70, 0.2);
  border-color: #8b6b46;
  color: #2c1810;
}

/* 右下角记录系统 */
.save-panel {
  position: absolute;
  bottom: 40px;
  right: 40px;
  background: rgba(245, 241, 232, 0.95);
  border-radius: 1px;
  padding: 20px;
  box-shadow: 
    0 4px 12px rgba(139, 107, 70, 0.2),
    inset 0 0 0 1px rgba(139, 107, 70, 0.3),
    inset 0 0 10px rgba(139, 107, 70, 0.05);
  min-width: 220px;
  pointer-events: auto;
  transition: all 0.3s ease;
  border: 1px solid #8b6b46;
}

.save-panel:hover {
  box-shadow: 
    0 6px 16px rgba(139, 107, 70, 0.25),
    inset 0 0 0 1px rgba(139, 107, 70, 0.4),
    inset 0 0 15px rgba(139, 107, 70, 0.08);
}

.save-title {
  font-size: 18px;
  font-weight: bold;
  color: #2c1810;
  margin-bottom: 15px;
  border-bottom: 2px solid #8b6b46;
  padding-bottom: 8px;
  letter-spacing: 1px;
  font-family: 'Times New Roman', serif;
  text-transform: uppercase;
  position: relative;
}

.save-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: #8b6b46;
}

.save-slots {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.save-slot {
  padding: 12px 15px;
  background: rgba(255, 253, 248, 0.7);
  border-radius: 1px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 15px;
  color: #5a4638;
  border: 1px solid rgba(139, 107, 70, 0.2);
  font-family: 'Courier New', monospace;
}

.save-slot:hover {
  background: rgba(255, 253, 248, 0.9);
  border-color: rgba(139, 107, 70, 0.4);
  transform: translateX(2px);
}

.save-slot.active {
  background: rgba(139, 107, 70, 0.1);
  color: #2c1810;
  border-color: #8b6b46;
  box-shadow: inset 0 0 10px rgba(139, 107, 70, 0.1);
}

.save-slot.empty {
  color: #8b6b46;
  font-style: italic;
  opacity: 0.8;
}

.save-buttons {
  display: flex;
  gap: 12px;
}

.save-btn, .load-btn {
  flex: 1;
  padding: 12px 15px;
  border: 1px solid #8b6b46;
  border-radius: 1px;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  pointer-events: auto;
  font-weight: normal;
  letter-spacing: 1px;
  font-family: 'Georgia', serif;
  text-transform: uppercase;
  background: rgba(245, 241, 232, 0.9);
  color: #2c1810;
}

.save-btn:hover, .load-btn:hover {
  background: rgba(139, 107, 70, 0.1);
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(139, 107, 70, 0.2);
}

.save-btn:disabled, .load-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
  color: #8b6b46;
}

/* 状态提示 */
.status-message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(245, 241, 232, 0.98);
  color: #2c1810;
  padding: 20px 35px;
  border-radius: 1px;
  font-size: 16px;
  z-index: 1001;
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
  text-align: center;
  box-shadow: 
    0 8px 20px rgba(139, 107, 70, 0.3),
    0 0 0 1px rgba(139, 107, 70, 0.4);
  border: 1px solid #8b6b46;
  min-width: 200px;
  font-family: 'Georgia', serif;
}

.status-message.show {
  opacity: 1;
}

/* 重新开始按钮 */
.restart-button {
  position: fixed;
  bottom: 40px;
  left: 40px;
  padding: 12px 25px;
  background: rgba(245, 241, 232, 0.9);
  color: #5a4638;
  border: 1px solid #8b6b46;
  border-radius: 1px;
  cursor: pointer;
  font-size: 14px;
  pointer-events: auto;
  transition: all 0.3s ease;
  z-index: 11;
  font-weight: normal;
  letter-spacing: 1px;
  font-family: 'Georgia', serif;
  text-transform: uppercase;
}

.restart-button::before {
  content: '↻ ';
  font-weight: bold;
}

.restart-button:hover {
  background: rgba(139, 107, 70, 0.1);
  color: #2c1810;
  box-shadow: 0 3px 8px rgba(139, 107, 70, 0.2);
}

/* 标题文字 */
.title-text {
  position: fixed;
  top: 40px;
  left: 40px;
  font-size: 32px;
  font-weight: normal;
  color: #2c1810;
  letter-spacing: 2px;
  z-index: 1;
  pointer-events: none;
  font-family: 'Times New Roman', serif;
  text-transform: uppercase;
}

.title-text::after {
  content: '';
  display: block;
  width: 100px;
  height: 2px;
  background: #8b6b46;
  margin-top: 8px;
}

.subtitle {
  position: fixed;
  top: 100px;
  left: 40px;
  font-size: 14px;
  color: #8b6b46;
  letter-spacing: 1px;
  z-index: 1;
  pointer-events: none;
  font-family: 'Georgia', serif;
  font-style: italic;
}

/* 档案编号 */
.archive-number {
  position: fixed;
  top: 40px;
  right: 300px;
  font-size: 14px;
  color: #8b6b46;
  letter-spacing: 1px;
  z-index: 1;
  pointer-events: none;
  font-family: 'Courier New', monospace;
  opacity: 0.7;
}

/* 日期戳 */
.date-stamp {
  position: fixed;
  bottom: 40px;
  left: 300px;
  font-size: 14px;
  color: #8b6b46;
  letter-spacing: 1px;
  z-index: 1;
  pointer-events: none;
  font-family: 'Courier New', monospace;
  opacity: 0.7;
}

/* 墨水污渍效果 */
.ink-stain {
  position: fixed;
  width: 200px;
  height: 200px;
  pointer-events: none;
  z-index: 0;
  opacity: 0.03;
  filter: blur(1px);
}

.stain-1 {
  top: 30%;
  left: 10%;
  background: radial-gradient(circle, #8b6b46 0%, transparent 70%);
}

.stain-2 {
  bottom: 20%;
  right: 15%;
  background: radial-gradient(circle, #8b6b46 0%, transparent 70%);
}

/* 打字机字体效果 */
.typewriter-text {
  font-family: 'Courier New', monospace;
  letter-spacing: 1px;
}

/* 档案袋图标 */
.file-icon {
  display: inline-block;
  width: 16px;
  height: 20px;
  background: rgba(139, 107, 70, 0.2);
  border: 1px solid #8b6b46;
  border-radius: 2px 2px 0 0;
  margin-right: 8px;
  position: relative;
}

.file-icon::after {
  content: '';
  position: absolute;
  top: 5px;
  left: 3px;
  right: 3px;
  height: 2px;
  background: #8b6b46;
}
</style>
</head>

<body>

<!-- 墨水污渍 -->
<div class="ink-stain stain-1"></div>
<div class="ink-stain stain-2"></div>

<!-- 标题文字 -->
<div class="title-text">档案记录系统</div>
<div class="subtitle">- 初始化界面 -</div>
<div class="archive-number">档案编号: A-2023-001</div>
<div class="date-stamp">记录时间: ██/██/████</div>

<!-- 游戏UI界面 -->
<div class="game-ui" id="gameUI">
  <!-- 开始记录按钮 -->
  <button class="start-button" id="startButton">开始记录</button>
  
  <!-- 右上角档案系统 -->
  <div class="achievement-panel">
    <div class="achievement-title">
      <span class="file-icon"></span>档案状态
    </div>
    <div class="achievement-list">
      <div class="achievement-item">
        <div class="achievement-icon achievement-unlocked">✓</div>
        <span>系统激活</span>
      </div>
      <div class="achievement-item">
        <div class="achievement-icon" id="achievement2">▢</div>
        <span>记录点 01</span>
      </div>
      <div class="achievement-item">
        <div class="achievement-icon" id="achievement3">▢</div>
        <span>记录点 02</span>
      </div>
      <div class="achievement-item">
        <div class="achievement-icon" id="achievement4">▢</div>
        <span>完整归档</span>
      </div>
    </div>
  </div>
  
  <!-- 右下角记录系统 -->
  <div class="save-panel">
    <div class="save-title">
      <span class="file-icon"></span>记录管理
    </div>
    <div class="save-slots">
      <div class="save-slot empty" id="saveSlot1">卷宗 01 - 待记录</div>
      <div class="save-slot empty" id="saveSlot2">卷宗 02 - 待记录</div>
      <div class="save-slot empty" id="saveSlot3">卷宗 03 - 待记录</div>
    </div>
    <div class="save-buttons">
      <button class="save-btn" id="saveBtn" disabled>封存记录</button>
      <button class="load-btn" id="loadBtn" disabled>调取记录</button>
    </div>
  </div>
</div>

<!-- 状态提示 -->
<div class="status-message" id="statusMessage"></div>

<!-- 重新开始按钮 -->
<button class="restart-button" id="restartButton">重新初始化</button>

<script>
// 存储记录状态
let recordState = {
  currentSaveSlot: null,
  archives: {
    systemActivated: true,
    recordPoint1: false,
    recordPoint2: false,
    completeArchive: false
  },
  progress: {
    recordPoint: 0,
    documents: []
  }
};

// 全局变量
let rotationStates = {
  ring1: 0,
  ring2: 0,
  ring3: 0
};
let currentHud = null;
let currentCross = null;
let rings = [];
let isAnimating = false;
let startTime = Date.now();

// 页面加载完成后自动开始动画
window.addEventListener('load', () => {
  // 从localStorage加载记录数据
  loadRecordData();
  
  // 更新档案状态显示
  updateArchivesDisplay();
  
  // 更新卷宗显示
  updateSaveSlotsDisplay();
  
  // 开始动画
  const targetX = window.innerWidth * 0.25;
  const targetY = window.innerHeight * 0.67;
  startAutoAnimation(targetX, targetY);
});

// 重新开始按钮点击事件
document.getElementById('restartButton').addEventListener('click', () => {
  // 重新创建所有元素
  document.body.innerHTML = `
    <!-- 墨水污渍 -->
    <div class="ink-stain stain-1"></div>
    <div class="ink-stain stain-2"></div>
    
    <!-- 标题文字 -->
    <div class="title-text">档案记录系统</div>
    <div class="subtitle">- 初始化界面 -</div>
    <div class="archive-number">档案编号: A-2023-001</div>
    <div class="date-stamp">记录时间: ██/██/████</div>
    
    <!-- 游戏UI界面 -->
    <div class="game-ui" id="gameUI">
      <button class="start-button" id="startButton">开始记录</button>
      <div class="achievement-panel">
        <div class="achievement-title">
          <span class="file-icon"></span>档案状态
        </div>
        <div class="achievement-list">
          <div class="achievement-item">
            <div class="achievement-icon achievement-unlocked">✓</div>
            <span>系统激活</span>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon" id="achievement2">▢</div>
            <span>记录点 01</span>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon" id="achievement3">▢</div>
            <span>记录点 02</span>
          </div>
          <div class="achievement-item">
            <div class="achievement-icon" id="achievement4">▢</div>
            <span>完整归档</span>
          </div>
        </div>
      </div>
      <div class="save-panel">
        <div class="save-title">
          <span class="file-icon"></span>记录管理
        </div>
        <div class="save-slots">
          <div class="save-slot empty" id="saveSlot1">卷宗 01 - 待记录</div>
          <div class="save-slot empty" id="saveSlot2">卷宗 02 - 待记录</div>
          <div class="save-slot empty" id="saveSlot3">卷宗 03 - 待记录</div>
        </div>
        <div class="save-buttons">
          <button class="save-btn" id="saveBtn" disabled>封存记录</button>
          <button class="load-btn" id="loadBtn" disabled>调取记录</button>
        </div>
      </div>
    </div>
    
    <div class="status-message" id="statusMessage"></div>
    <button class="restart-button" id="restartButton">重新初始化</button>
  `;
  
  // 重新绑定事件
  setupEventListeners();
  
  // 更新显示
  updateArchivesDisplay();
  updateSaveSlotsDisplay();
  
  // 开始动画
  const targetX = window.innerWidth * 0.25;
  const targetY = window.innerHeight * 0.67;
  startAutoAnimation(targetX, targetY);
});

// 从localStorage加载记录数据
function loadRecordData() {
  const savedData = localStorage.getItem('archive_record_data');
  if (savedData) {
    try {
      recordState = JSON.parse(savedData);
      showStatus('记录数据已同步');
    } catch (e) {
      console.error('加载记录数据失败:', e);
    }
  }
}

// 保存记录数据到localStorage
function saveRecordData() {
  try {
    localStorage.setItem('archive_record_data', JSON.stringify(recordState));
    showStatus('记录已封存');
    updateSaveSlotsDisplay();
  } catch (e) {
    console.error('保存记录数据失败:', e);
    showStatus('封存失败，请检查存储权限');
  }
}

// 显示状态提示
function showStatus(message) {
  const statusMsg = document.getElementById('statusMessage');
  statusMsg.textContent = message;
  statusMsg.classList.add('show');
  
  setTimeout(() => {
    statusMsg.classList.remove('show');
  }, 2000);
}

// 更新档案状态显示
function updateArchivesDisplay() {
  const archives = [
    { id: 'achievement2', unlocked: recordState.archives.recordPoint1 },
    { id: 'achievement3', unlocked: recordState.archives.recordPoint2 },
    { id: 'achievement4', unlocked: recordState.archives.completeArchive }
  ];
  
  archives.forEach((archive, index) => {
    const el = document.getElementById(archive.id);
    if (archive.unlocked) {
      el.classList.add('achievement-unlocked');
      el.textContent = '✓';
    } else {
      el.classList.remove('achievement-unlocked');
      el.textContent = '▢';
    }
  });
}

// 更新卷宗显示
function updateSaveSlotsDisplay() {
  const saveData = {};
  for (let i = 1; i <= 3; i++) {
    const slotData = localStorage.getItem(`archive_save_slot_${i}`);
    saveData[i] = slotData ? JSON.parse(slotData) : null;
  }
  
  for (let i = 1; i <= 3; i++) {
    const slot = document.getElementById(`saveSlot${i}`);
    if (saveData[i]) {
      const pointNum = saveData[i].progress.recordPoint || 0;
      slot.textContent = `卷宗 0${i} - 记录点 ${pointNum}`;
      slot.classList.remove('empty');
    } else {
      slot.textContent = `卷宗 0${i} - 待记录`;
      slot.classList.add('empty');
    }
    
    slot.classList.remove('active');
    
    if (recordState.currentSaveSlot === i) {
      slot.classList.add('active');
    }
  }
}

// 设置事件监听器
function setupEventListeners() {
  // 开始记录按钮点击事件
  document.getElementById('startButton').addEventListener('click', () => {
    showStatus('正在进入记录界面...');
    
    // 延迟跳转
    setTimeout(() => {
      window.location.href = 'graph.html';
    }, 800);
  });
  
  // 卷宗点击事件
  for (let i = 1; i <= 3; i++) {
    document.getElementById(`saveSlot${i}`).addEventListener('click', () => {
      recordState.currentSaveSlot = i;
      updateSaveSlotsDisplay();
      
      document.getElementById('saveBtn').disabled = false;
      document.getElementById('loadBtn').disabled = false;
      
      showStatus(`已选择卷宗 0${i}`);
    });
  }
  
  // 封存按钮点击事件
  document.getElementById('saveBtn').addEventListener('click', () => {
    if (!recordState.currentSaveSlot) {
      showStatus('请先选择卷宗');
      return;
    }
    
    localStorage.setItem(`archive_save_slot_${recordState.currentSaveSlot}`, JSON.stringify(recordState));
    saveRecordData();
  });
  
  // 调取按钮点击事件
  document.getElementById('loadBtn').addEventListener('click', () => {
    if (!recordState.currentSaveSlot) {
      showStatus('请先选择卷宗');
      return;
    }
    
    const savedData = localStorage.getItem(`archive_save_slot_${recordState.currentSaveSlot}`);
    if (savedData) {
      try {
        recordState = JSON.parse(savedData);
        saveRecordData();
        updateArchivesDisplay();
        showStatus(`已调取卷宗 0${recordState.currentSaveSlot}`);
      } catch (e) {
        showStatus('调取记录失败，数据损坏');
      }
    } else {
      showStatus('该卷宗为空');
    }
  });
}

// 开始动画
function startAutoAnimation(tx, ty) {
  // 创建十字线
  const cross = document.createElement('div');
  cross.className = 'cross';
  currentCross = cross;

  const h = document.createElement('div');
  const v = document.createElement('div');
  h.className = 'line h-line';
  v.className = 'line v-line';

  cross.append(h, v);
  document.body.appendChild(cross);

  // 十字线初始位置固定在屏幕右上角
  const ix = window.innerWidth * 0.85;
  const iy = window.innerHeight * 0.15;

  cross.style.left = ix + 'px';
  cross.style.top = iy + 'px';

  // 两条线都从右上角外侧开始
  h.style.left = '160vw';
  h.style.top = '0';
  v.style.top = '-160vh';
  v.style.left = '0';

  // 第一步：两条线从右上角外侧移动到相交点
  requestAnimationFrame(() => {
    h.style.transition = 'left 0.4s cubic-bezier(0.4, 0, 0.6, 1)';
    v.style.transition = 'top 0.4s cubic-bezier(0.4, 0, 0.6, 1)';
    h.style.left = '-80vw';
    v.style.top = '-80vh';
  });

  // 第二步：等待0.55秒后，将整个十字线移动到目标位置
  setTimeout(() => {
    cross.style.transition = 'transform 0.9s ease-out';
    cross.style.transform = `translate(${tx - ix}px, ${ty - iy}px)`;
  }, 550);

  // 创建HUD圆环
  setTimeout(() => {
    const hud = document.createElement('div');
    hud.className = 'hud';
    hud.style.left = tx + 'px';
    hud.style.top = ty + 'px';
    currentHud = hud;

    hud.innerHTML = `
<svg viewBox="0 0 360 360">
  <circle cx="180" cy="180" r="28"
    fill="none" stroke="#8b6b46" stroke-width="3.6"
    class="lock-pulse"/>
</svg>`;
    document.body.appendChild(hud);

    // 显示同心圆
    setTimeout(() => {
      // 创建三个同心圆的SVG
      hud.innerHTML = `
<svg viewBox="0 0 360 360" id="rotating-circles">
  <circle cx="180" cy="180" r="28"
    fill="none" stroke="#8b6b46" stroke-width="3.6"/>
  <g id="ring1" class="rotating">
    <circle cx="180" cy="180" r="72"
      fill="none" stroke="#8b6b46" stroke-width="1.2"
      stroke-dasharray="220 80" stroke-linecap="round"/>
  </g>
  <g id="ring2" class="rotating">
    <circle cx="180" cy="180" r="104"
      fill="none" stroke="#a37c52" stroke-width="1.8"
      stroke-dasharray="190 90" stroke-linecap="round"/>
  </g>
  <g id="ring3" class="rotating">
    <circle cx="180" cy="180" r="140"
      fill="none" stroke="#8b6b46" stroke-width="3.6"
      stroke-dasharray="260 100" stroke-linecap="round"/>
  </g>
</svg>`;

      // 开始旋转动画
      rings = [
        { element: hud.querySelector('#ring1'), speed: 32, id: 'ring1', direction: 1 },
        { element: hud.querySelector('#ring2'), speed: 22, id: 'ring2', direction: -1 },
        { element: hud.querySelector('#ring3'), speed: 14, id: 'ring3', direction: 1 }
      ];
      
      startTime = Date.now();
      isAnimating = true;
      
      // 开始旋转
      updateRotation();
      
      // 旋转开始后等待1秒，然后触发快速消失效果
      setTimeout(() => {
        isAnimating = false;
        
        rings.forEach(ring => {
          ring.element.classList.add('quick-disappear');
        });
        
        // 消失动画结束后，重新开始旋转
        setTimeout(() => {
          rings.forEach(ring => {
            ring.element.classList.remove('quick-disappear');
            ring.element.style.opacity = '1';
          });
          
          isAnimating = true;
          startTime = Date.now() - (rotationStates.ring1 / 360 * 32 * 1000);
          updateRotation();
          
          // 动画结束后显示游戏UI界面
          setTimeout(() => {
            document.getElementById('gameUI').classList.add('show');
            document.body.style.cursor = 'default';
          }, 500);
          
        }, 600);

      }, 1000);

    }, 1600);

  }, 1700);
}

// 旋转动画函数
function updateRotation() {
  if (!isAnimating) return;
  
  const elapsed = Date.now() - startTime;
  
  rings.forEach(ring => {
    const degrees = (elapsed / (ring.speed * 1000)) * 360 * ring.direction;
    ring.element.style.transform = `rotate(${degrees}deg)`;
    rotationStates[ring.id] = degrees % 360;
  });
  
  requestAnimationFrame(updateRotation);
}

// 初始化事件监听器
setupEventListeners();
</script>
</body>
</html>
